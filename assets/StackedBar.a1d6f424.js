import{d as L,_ as R,r as w,x as P,b as X,y as $,o as g,c as k,h as A,u as i,a as l,g as S,z as q,j as H,A as U,F as V,e as Y,B as z,t as p,f as G,q as J,s as K}from"./index.57c99b8c.js";import{Y as Q,f as E,g as W}from"./YearSelector.ddbc04a9.js";import{c as B}from"./test.bf31bb5e.js";import{l as Z,S as j,L as ee}from"./Story.aac12bf8.js";function D(t){return function(){return t}}function te(t){return typeof t=="object"&&"length"in t?t:Array.from(t)}function I(t,e){if((h=t.length)>1)for(var n=1,o,r,a=t[e[0]],h,c=a.length;n<h;++n)for(r=a,a=t[e[n]],o=0;o<c;++o)a[o][1]+=a[o][0]=isNaN(r[o][1])?r[o][0]:r[o][1]}function F(t){for(var e=t.length,n=new Array(e);--e>=0;)n[e]=e;return n}function ae(t,e){return t[e]}function ne(t){const e=[];return e.key=t,e}function oe(){var t=D([]),e=F,n=I,o=ae;function r(a){var h=Array.from(t.apply(this,arguments),ne),c,m=h.length,f=-1,d;for(const s of a)for(c=0,++f;c<m;++c)(h[c][f]=[0,+o(s,h[c].key,f,a)]).data=s;for(c=0,d=te(e(h));c<m;++c)h[d[c]].index=c;return n(h,d),h}return r.keys=function(a){return arguments.length?(t=typeof a=="function"?a:D(Array.from(a)),r):t},r.value=function(a){return arguments.length?(o=typeof a=="function"?a:D(+a),r):o},r.order=function(a){return arguments.length?(e=a==null?F:typeof a=="function"?a:D(Array.from(a)),r):e},r.offset=function(a){return arguments.length?(n=a==null?I:a,r):n},r}function re(t){var e=t.map(se);return F(t).sort(function(n,o){return e[n]-e[o]})}function se(t){for(var e=0,n=-1,o=t.length,r;++n<o;)(r=+t[n][1])&&(e+=r);return e}const O=[];for(let t=4;t<B.meta.length;t++)O.push(t);const ie=oe().keys(O).value((t,e)=>t[e]/t[2]).order(re),le=t=>Object.entries(B[t]).filter(e=>e[0]!=="sum"),ce=L("stack",{state:()=>{const e=le(1990),n=100;return{year:1990,data:e,meta:B.meta,base:n,x:null,search:""}},actions:{setXScale(t){this.x=Z().domain([0,1]).range([0,t])},setYear(t){this.year=t,this.updateData()},updateData(){this.containers=[];const t=new RegExp(this.search,"i");this.data=Object.entries(B[this.year]).filter(e=>e[0]!=="sum"&&t.test(e[1][0]))},getStackedData(t){return ie([t])},scaleColor(t){return t<.1?"#99D594":t<.2?"#FEE08B":t<.3?"#FC8D59":"#D53E4F"}}});const ue=t=>(J("data-v-a3159ff7"),t=t(),K(),t),he={class:"legend-and-search-wrapper"},fe=ue(()=>l("button",null,"Search",-1)),de=["width","height"],pe=["transform"],ge={"dominant-baseline":"hanging"},me=["x"],ye=["fill","x","width","onMouseenter","onMouseleave"],ve={class:"tooltip-content"},we={__name:"StackedBar",setup(t){const e=ce(),n=w(),o=P({width:0,height:e.base}),r=w([]),a=w(),h=w(),c=w(),m=()=>{var u,_,b;const f=[],d=(u=h.value)==null?void 0:u.getBoundingClientRect().height,s=(b=(_=c.value)==null?void 0:_.scrollTop)!=null?b:0,C=s+window.innerHeight;e.data.forEach((x,y)=>{const v=y*e.base+d;v+e.base<s||C<v||f.push([x,y])}),r.value=f};return X(()=>{const{width:f}=n.value.getBoundingClientRect();o.width=f,e.setXScale(f),$(()=>e.data,m,{immediate:!0})}),(f,d)=>(g(),k("main",{ref_key:"main",ref:a},[A(Q,{default:i(e).year,onChange:i(e).setYear},null,8,["default","onChange"]),l("section",{ref_key:"section",ref:c,onScroll:m},[l("header",{ref_key:"header",ref:h},[A(j,null,{title:S(()=>[z(" This graph shows the total number of deaths and the percentage of different death reasons for each country/region. ")]),content:S(()=>[z(" Overall, the total number of deaths in most countries/regions shows an upward trend with each year. This roughly stems from the rise in world population, which is predictable. Each country/region shows different percentages of death reasons while Cardiovascular Diseases and Neoplasms remain the leading causes of death in the majority of countries/regions. Some countries/regions do not have very high threat level death reasons, only some relatively high threat death reasons, while some countries/regions have much more serious death reasons. This may be closely related to each country/region's situation, people's diet, climate, and other factors. ")]),_:1}),l("div",he,[A(ee),l("form",{class:"search-wrapper",onSubmit:d[1]||(d[1]=q((...s)=>i(e).updateData&&i(e).updateData(...s),["prevent"]))},[H(l("input",{type:"text","onUpdate:modelValue":d[0]||(d[0]=s=>i(e).search=s)},null,512),[[U,i(e).search]]),fe],32)])],512),l("div",{ref_key:"wrapper",ref:n},[(g(),k("svg",{width:o.width,height:i(e).base*i(e).data.length},[(g(!0),k(V,null,Y(r.value,([s,C])=>(g(),k("g",{transform:`translate(0,${C*i(e).base})`,key:s[0]},[l("text",ge,p(s[1][0]),1),l("text",{"dominant-baseline":"hanging","text-anchor":"end",fill:"gray",x:o.width}," Total Death: "+p(i(E)(s[1][2])),9,me),(g(!0),k(V,null,Y(i(e).getStackedData(s[1]),u=>(g(),G(W,{key:u.key},{target:S(({onMouseEnter:_,onMouseLeave:b})=>{var x,y,v,T,M,N;return[l("rect",{fill:i(e).scaleColor(u[0][1]-u[0][0]),stroke:"white",x:(v=(y=(x=i(e)).x)==null?void 0:y.call(x,u[0][0]))!=null?v:0,y:"25",width:(N=(M=(T=i(e)).x)==null?void 0:M.call(T,u[0][1]-u[0][0]))!=null?N:0,height:"50",onMouseenter:_,onMouseleave:b},null,40,ye)]}),content:S(()=>[l("div",ve,[l("h4",null,p(i(e).meta[u.key]),1),l("p",null,"Year: "+p(i(e).year),1),l("p",null,"Population: "+p(i(E)(s[1][1])),1),l("p",null,"Death: "+p(i(E)(s[1][u.key])),1),l("p",null,"Death / Population: "+p((s[1][u.key]/s[1][1]*100).toFixed(2))+"%",1),l("p",null,"Death / Total Death "+p(((u[0][1]-u[0][0])*100).toFixed(2))+"%",1)])]),_:2},1024))),128))],8,pe))),128))],8,de))],512)],544)],512))}},Se=R(we,[["__scopeId","data-v-a3159ff7"]]);export{Se as default};
